<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="A3Nest.Presentation.Pages.CalendarPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:components="clr-namespace:A3Nest.Presentation.Components"
             xmlns:viewmodels="clr-namespace:A3Nest.Presentation.ViewModels"
             x:DataType="viewmodels:CalendarViewModel"
             x:Name="CalendarPageView"
             Title="{Binding Title}">

    <Grid RowDefinitions="Auto,Auto,*" Padding="16" RowSpacing="16">
        
        <!-- Header Section -->
        <StackLayout Grid.Row="0" Spacing="8">
            <Label Text="Calendar Management"
                   FontSize="28"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}" />
            <Label Text="Manage events, appointments, and scheduling"
                   FontSize="16"
                   TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}" />
        </StackLayout>

        <!-- Navigation and Controls -->
        <Grid Grid.Row="1" ColumnDefinitions="Auto,*,Auto,Auto,Auto" ColumnSpacing="12">
            
            <!-- Previous Period Button -->
            <Button Grid.Column="0"
                    Text="â—€"
                    Command="{Binding NavigateToPreviousPeriodCommand}"
                    BackgroundColor="Transparent"
                    TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                    FontSize="18"
                    WidthRequest="40" />

            <!-- Current Period Display -->
            <StackLayout Grid.Column="1" VerticalOptions="Center">
                <Label Text="{Binding CurrentMonthYear}"
                       FontSize="20"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"
                       TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}" />
            </StackLayout>

            <!-- Next Period Button -->
            <Button Grid.Column="2"
                    Text="â–¶"
                    Command="{Binding NavigateToNextPeriodCommand}"
                    BackgroundColor="Transparent"
                    TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                    FontSize="18"
                    WidthRequest="40" />

            <!-- Today Button -->
            <Button Grid.Column="3"
                    Text="Today"
                    Command="{Binding NavigateToTodayCommand}"
                    BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                    TextColor="White"
                    FontSize="14"
                    Padding="12,6"
                    CornerRadius="6" />

            <!-- Add Event Button -->
            <Button Grid.Column="4"
                    Text="Add Event"
                    Command="{Binding StartCreatingEventCommand}"
                    BackgroundColor="{AppThemeBinding Light={StaticResource Secondary}, Dark={StaticResource SecondaryDark}}"
                    TextColor="White"
                    FontSize="14"
                    Padding="12,6"
                    CornerRadius="6" />
        </Grid>

        <!-- Calendar Content -->
        <Grid Grid.Row="2" ColumnDefinitions="2*,*" ColumnSpacing="16">
            
            <!-- Main Calendar View -->
            <Border Grid.Column="0"
                    BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}"
                    Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                    StrokeThickness="1"
                    StrokeShape="RoundRectangle 8"
                    Padding="16">
                
                <StackLayout Spacing="16">
                    <Label Text="Calendar Events"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}" />
                    
                    <!-- Events List -->
                    <CollectionView ItemsSource="{Binding FilteredEvents}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="12" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                                    <Grid.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding Source={x:Reference CalendarPageView}, Path=BindingContext.ViewEventDetailsCommand}"
                                                              CommandParameter="{Binding .}" />
                                    </Grid.GestureRecognizers>

                                    <!-- Time -->
                                    <StackLayout Grid.Column="0" VerticalOptions="Center">
                                        <Label Text="{Binding StartDate, StringFormat='{0:MMM dd}'}"
                                               FontSize="12"
                                               FontAttributes="Bold"
                                               TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                                        <Label Text="{Binding StartDate, StringFormat='{0:HH:mm}'}"
                                               FontSize="10"
                                               TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}" />
                                    </StackLayout>

                                    <!-- Event Details -->
                                    <StackLayout Grid.Column="1" Spacing="4">
                                        <Label Text="{Binding Title}"
                                               FontSize="16"
                                               FontAttributes="Bold"
                                               TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}" />
                                        <Label Text="{Binding Description}"
                                               FontSize="14"
                                               TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}"
                                               LineBreakMode="TailTruncation" />
                                        <Label Text="{Binding Location}"
                                               FontSize="12"
                                               TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray500}}" />
                                    </StackLayout>

                                    <!-- Actions -->
                                    <StackLayout Grid.Column="2" Orientation="Horizontal" Spacing="8">
                                        <Button Text="Edit"
                                                Command="{Binding Source={x:Reference CalendarPageView}, Path=BindingContext.EditEventCommand}"
                                                CommandParameter="{Binding .}"
                                                BackgroundColor="Transparent"
                                                TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                                                FontSize="12"
                                                Padding="8,4" />
                                        <Button Text="Delete"
                                                Command="{Binding Source={x:Reference CalendarPageView}, Path=BindingContext.DeleteEventCommand}"
                                                CommandParameter="{Binding .}"
                                                BackgroundColor="Transparent"
                                                TextColor="{AppThemeBinding Light={StaticResource Danger}, Dark={StaticResource DangerDark}}"
                                                FontSize="12"
                                                Padding="8,4" />
                                    </StackLayout>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                        
                        <CollectionView.EmptyView>
                            <StackLayout Padding="40" Spacing="16" VerticalOptions="Center">
                                <Label Text="ðŸ“…"
                                       FontSize="48"
                                       HorizontalOptions="Center" />
                                <Label Text="No events scheduled"
                                       FontSize="18"
                                       FontAttributes="Bold"
                                       HorizontalOptions="Center"
                                       TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}" />
                                <Label Text="Add your first event to get started"
                                       FontSize="14"
                                       HorizontalOptions="Center"
                                       TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray500}}" />
                            </StackLayout>
                        </CollectionView.EmptyView>
                    </CollectionView>
                </StackLayout>
            </Border>

            <!-- Sidebar -->
            <StackLayout Grid.Column="1" Spacing="16">
                
                <!-- Today's Events -->
                <Border BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}"
                        Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                        StrokeThickness="1"
                        StrokeShape="RoundRectangle 8"
                        Padding="16">
                    <StackLayout Spacing="12">
                        <Label Text="Today's Events"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}" />
                        
                        <CollectionView ItemsSource="{Binding TodayEvents}"
                                        HeightRequest="150">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <StackLayout Padding="0,4" Spacing="2">
                                        <Label Text="{Binding Title}"
                                               FontSize="14"
                                               FontAttributes="Bold" />
                                        <Label Text="{Binding StartDate, StringFormat='{0:HH:mm}'}"
                                               FontSize="12"
                                               TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}" />
                                    </StackLayout>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                            <CollectionView.EmptyView>
                                <Label Text="No events today"
                                       FontSize="14"
                                       TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray500}}"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center" />
                            </CollectionView.EmptyView>
                        </CollectionView>
                    </StackLayout>
                </Border>

                <!-- Upcoming Events -->
                <Border BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}"
                        Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                        StrokeThickness="1"
                        StrokeShape="RoundRectangle 8"
                        Padding="16">
                    <StackLayout Spacing="12">
                        <Label Text="Upcoming Events"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}" />
                        
                        <CollectionView ItemsSource="{Binding UpcomingEvents}"
                                        HeightRequest="200">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <StackLayout Padding="0,4" Spacing="2">
                                        <Label Text="{Binding Title}"
                                               FontSize="14"
                                               FontAttributes="Bold" />
                                        <Label Text="{Binding StartDate, StringFormat='{0:MMM dd, HH:mm}'}"
                                               FontSize="12"
                                               TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}" />
                                    </StackLayout>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                            <CollectionView.EmptyView>
                                <Label Text="No upcoming events"
                                       FontSize="14"
                                       TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray500}}"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center" />
                            </CollectionView.EmptyView>
                        </CollectionView>
                    </StackLayout>
                </Border>
            </StackLayout>
        </Grid>
    </Grid>

    <!-- Loading Overlay -->
    <Grid IsVisible="{Binding IsLoading}"
          BackgroundColor="Black"
          Opacity="0.5">
        <ActivityIndicator IsRunning="{Binding IsLoading}"
                           Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                           VerticalOptions="Center"
                           HorizontalOptions="Center" />
    </Grid>
</ContentPage>